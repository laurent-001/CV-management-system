{% extends 'jobs/dashboard_base.html' %}
{% load static %}

{% block title %}Edit Profile{% endblock %}
{% block page_title %}Edit Profile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'jobs/css/profile_image_upload.css' %}">
{% endblock %}

{% block content %}
<div class="form-container" style="max-width: 700px; margin: auto; padding: 2rem; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

    <!-- Profile Image Upload Component -->
    <div class="profile-image-upload-container">
        <div class="profile-image-wrapper" id="profileImageWrapper" title="Click or drag image to upload">
            <div class="profile-image-circle">
                <img src="{% if user.profile.profile_picture %}{{ user.profile.profile_picture.url }}{% else %}{% static 'images/default-profile.svg' %}{% endif %}" alt="Profile Picture" id="imagePreview">
            </div>
            <div class="profile-image-overlay">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-camera-fill" viewBox="0 0 16 16">
                    <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                    <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z"/>
                </svg>
            </div>
        </div>
        <input type="file" id="profileImageInput" accept="image/jpeg, image/png, image/jpg" style="display: none;">
        <div class="profile-image-buttons">
            <button type="button" class="btn-upload" onclick="document.getElementById('profileImageInput').click();">Change Photo</button>
            <button type="button" class="btn-remove" id="removeProfileImageBtn">Remove Photo</button>
        </div>
        <div class="upload-status" id="uploadStatus"></div>
    </div>

    <hr style="margin: 2rem 0;">

    <!-- Original Profile Form -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.bio.id_for_label }}">Bio:</label>
            {{ form.bio }}
        </div>

        <div class="form-group">
            <label for="{{ form.cv.id_for_label }}">CV:</label>
            {{ form.cv }}
            {% if user.profile.cv %}
                <p class="current-cv">Current CV: <a href="{{ user.profile.cv.url }}" target="_blank">{{ user.profile.cv.name|cut:"cvs/" }}</a></p>
            {% endif %}
        </div>

        <button type="submit" class="btn-upload" style="width: 100%; margin-top: 1rem;">Save Profile Changes</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'jobs/js/profile_image_upload.js' %}"></script>
{% endblock %}
